<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>D07 ¬∑ Routes, Territory &amp; the Daily Record</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="lesson-page" data-lesson="d07">
  <div class="reading-progress" id="readingProgress"></div>
  <div class="ambient"><div class="ambient-orb orb-1"></div><div class="ambient-orb orb-2"></div><div class="ambient-orb orb-3"></div></div>
  <main class="main">
    <div class="content lesson-shell">
      <div class="page-nav">
        <a class="nav-btn" href="lesson-d06.html">‚Üê Previous lesson</a>
        <a class="nav-btn" href="index.html">Roadmap</a>
        <a class="nav-btn" href="lesson-d08.html">Next lesson ‚Üí</a>
      </div>

      <header class="lesson-head">
        <div class="sec-label">Phase 2 ¬∑ Schema Mastery</div>
        <h1>D07 ¬∑ Routes, Territory &amp; the Daily Record</h1>
        <p>Estimated time: ~2 hrs</p>
      </header>

      <section class="lesson-ops">
        <button class="nav-btn" id="markComplete">Mark complete</button>
        <button class="nav-btn" id="bookmarkLesson">Bookmark</button>
        <span class="ops-hint" id="lessonStatus">Track your progress and keep notes below.</span>
      </section>

      <article class="day-body" id="lessonBody">
<div class="goal"><span class="goal-tag">Today's Goal</span><span class="goal-txt">Understand how the business operates day to day and how it maps to tables. RouteHistory is the most-linked table in the database ‚Äî 167 other tables connect to it.</span></div>

        <div class="analogy">
          <span class="analogy-ico">üöó</span>
          <div>
            <div class="analogy-lbl">The Delivery Driver Analogy</div>
            <p><strong>Route</strong> = planned stops for today (Route 5 visits shops A, B, C, D)<br>
            <strong>RouteHistory</strong> = what actually happened (Ahmed started 8am, ended 5pm)<br>
            <strong>RouteHistoryDetail</strong> = each stop (arrived Shop A at 9am, sold 50 units)<br>
            <strong>Transaction</strong> = the invoice created at each shop</p>
          </div>
        </div>

        <div class="code-wrap">
          <div class="code-bar"><span class="code-lbl">Explore RouteHistory ‚Äî hub of all daily data</span><button class="copy-btn" onclick="doCopy(this)">Copy</button></div>
          <pre><span class="kw">SELECT TOP</span> <span class="num">20</span>
    rh.RouteHistoryID,
    <span class="fn">CAST</span>(rh.RouteDate <span class="kw">AS DATE</span>)  <span class="kw">AS</span> RouteDate,
    rh.EmployeeID,
    rh.TerritoryID,         <span class="cm">-- Stored directly ‚Äî no chain needed here</span>
    rh.IsRouteEnded,        <span class="cm">-- 1 = day complete, data is final</span>
    rh.Uploaded             <span class="cm">-- 1 = device has synced to server</span>
<span class="kw">FROM</span> <span class="tb">RouteHistory</span> rh
<span class="kw">ORDER BY</span> rh.RouteDate <span class="kw">DESC</span>;</pre>
        </div>

        <div class="code-wrap">
          <div class="code-bar"><span class="code-lbl">Visit outcomes ‚Äî what happened at each shop stop</span><button class="copy-btn" onclick="doCopy(this)">Copy</button></div>
          <pre><span class="kw">SELECT</span>
    rhd.CustomerID,
    <span class="kw">CASE</span>
        <span class="kw">WHEN</span> vs.IsProductive = <span class="num">1</span>                      <span class="kw">THEN</span> <span class="str">'Visited + Sale'</span>
        <span class="kw">WHEN</span> vs.IsVisited = <span class="num">1</span> <span class="kw">AND</span> vs.IsProductive = <span class="num">0</span> <span class="kw">THEN</span> <span class="str">'Visited, No Sale'</span>
        <span class="kw">ELSE</span>                                              <span class="str">'Skipped'</span>
    <span class="kw">END</span> <span class="kw">AS</span> Outcome
<span class="kw">FROM</span> <span class="tb">RouteHistoryDetail</span> rhd
<span class="kw">LEFT JOIN</span> <span class="tb">VisitStatus</span> vs
    <span class="kw">ON</span> vs.VisitStatusID = rhd.VisitStatusID
<span class="kw">WHERE</span> rhd.RouteHistoryID = (
    <span class="kw">SELECT TOP</span> <span class="num">1</span> RouteHistoryID <span class="kw">FROM</span> <span class="tb">RouteHistory</span> <span class="kw">ORDER BY</span> RouteDate <span class="kw">DESC</span>
);</pre>
        </div>

        <div class="exercise">
          <div class="ex-hd">‚úèÔ∏è Practice</div>
          <p>Run both queries. For the second: count "Visited + Sale", "Visited, No Sale", and "Skipped". Calculate the visit rate (visited √∑ total) and sales rate (sold √∑ visited) as percentages.</p>
        </div>
      </article>

      <section class="notes-panel">
        <div class="c-hd">Personal Notes</div>
        <textarea id="lessonNotes" placeholder="Capture your query strategy, key joins, and gotchas for this lesson..."></textarea>
      </section>

      <div class="page-nav">
        <a class="nav-btn" href="lesson-d06.html">‚Üê Previous lesson</a>
        <a class="nav-btn" href="index.html">Roadmap</a>
        <a class="nav-btn" href="lesson-d08.html">Next lesson ‚Üí</a>
      </div>

      <footer class="site-footer">SONIC SQL Training Platform ¬∑ D07</footer>
    </div>
  </main>
  <script src="data.js"></script>
  <script src="scripts.js"></script>
</body>
</html>
